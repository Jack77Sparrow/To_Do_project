<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Create task</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="static/new_task_styles.css" />
  </head>

  <body>
    <div class="card">
      <h1>Create task</h1>

      <form id="taskForm">
        <!-- TITLE -->
        <label for="title">Title</label>
        <input
          type="text"
          id="title"
          name="title"
          placeholder="Write task title"
          required
        />

        <!-- DESCRIPTION -->
        <label for="description">Description</label>
        <textarea
          id="description"
          name="description"
          placeholder="Write task details here..."
        ></textarea>

        <!-- PRIORITY + STATUS -->
        <div class="row">
          <div>
            <label for="priority">Priority</label>
            <select id="priority" name="priority">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>

          <div>
            <label for="status">Status</label>
            <select id="status" name="status">
              <option value="pending" selected>Pending</option>
              <option value="in progress">In progress</option>
              <option value="done">Done</option>
            </select>
          </div>
        </div>

        <!-- DUE DATE -->
        <label for="due_to">Due date</label>
        <input type="date" id="due_to" name="due_to" />

        <div class="info">
          Category and difficulty are assigned automatically.
        </div>

        <!-- ACTIONS -->
        <div class="actions">
          <button type="button" class="btn cancel" onclick="history.back()">
            Cancel
          </button>
          <button type="submit" class="btn create">Create</button>
        </div>

        <div id="toast" class="toast"></div>
      </form>
    </div>

    <script>
      const form = document.getElementById("taskForm");
      const toast = document.getElementById("toast");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        toast.style.display = "none";

        const formData = new FormData(form);
        function showError(message) {
        //   console.log(message);
        //   const box = document.getElementById("errorBox");
        //   console.log(box);
          toast.textContent = message;
          toast.className = 'toast error'
          toast.style.display = "block";
        }
        try {
          const res = await fetch("/add_task", {
            method: "POST",
            body: formData,
          });

          if (!res.ok) {
            const err = await res.json();
            showError(err.detail || "Unknown error");
            return;
          }

          toast.textContent = "Task created successfully";
          toast.className = "toast";
          toast.style.display = "block";

          form.reset();

          setTimeout(() => {
            window.location.href = "/";
          }, 600);
        } catch (err) {
          showError("Network error");
        }
      });
    </script>
  </body>
</html>
